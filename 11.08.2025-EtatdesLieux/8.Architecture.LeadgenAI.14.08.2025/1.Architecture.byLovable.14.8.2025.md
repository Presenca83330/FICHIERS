# ARCHITECTURE LEADGENAI ADBUILDER
**Diagramme d'architecture gÃ©nÃ©rÃ© le 14/08/2025**

---

## ğŸ¯ VUE D'ENSEMBLE SYSTÃˆME

```mermaid
graph TB
    subgraph "UTILISATEURS"
        USER[ğŸ‘¤ Utilisateur Final]
    end
    
    subgraph "FRONTEND LOVABLE"
        WEBAPP[ğŸŒ Application Web React]
        WEBAPP --> AUTH[ğŸ” Authentification]
        WEBAPP --> CLIENT_UI[ğŸ¢ Interface Client]
        WEBAPP --> ADMIN_UI[âš™ï¸ Interface Admin]
        WEBAPP --> RESEAU_UI[ğŸ˜ï¸ Interface RÃ©seau]
    end
    
    subgraph "SUPABASE BACKEND"
        AUTH_DB[(ğŸ”‘ auth.users)]
        MAIN_DB[(ğŸ“Š Base Principale)]
        RLS[ğŸ›¡ï¸ Row Level Security]
        FUNCTIONS[âš¡ Edge Functions]
    end
    
    subgraph "AGENTS IA"
        IA_ANNONCE[ğŸ“ Agent Annonce]
        IA_MARKETING[ğŸ“§ Agent Marketing]
        IA_LANDING[ğŸŒ Agent Landing Page]
        IA_SOCIAL[ğŸ“± Agent RÃ©seaux Sociaux]
        IA_SOURCING[ğŸ” Agent Sourcing]
        IA_CAMPAGNE[ğŸ¯ Agent Campagnes]
    end
    
    subgraph "APIS EXTERNES"
        OPENAI[ğŸ¤– OpenAI]
        BREVO[ğŸ“§ Brevo]
        LINKEDIN[ğŸ’¼ LinkedIn]
        FACEBOOK[ğŸ“˜ Facebook]
        INSTAGRAM[ğŸ“¸ Instagram]
        STRIPE[ğŸ’³ Stripe]
    end
    
    USER --> WEBAPP
    WEBAPP --> MAIN_DB
    WEBAPP --> AUTH_DB
    WEBAPP --> FUNCTIONS
    FUNCTIONS --> IA_ANNONCE
    FUNCTIONS --> IA_MARKETING
    FUNCTIONS --> IA_LANDING
    FUNCTIONS --> IA_SOCIAL
    FUNCTIONS --> IA_SOURCING
    FUNCTIONS --> IA_CAMPAGNE
    
    IA_ANNONCE --> OPENAI
    IA_MARKETING --> BREVO
    IA_SOCIAL --> LINKEDIN
    IA_SOCIAL --> FACEBOOK
    IA_SOCIAL --> INSTAGRAM
    WEBAPP --> STRIPE
```

---

## ğŸ—ï¸ ARCHITECTURE MULTI-TENANT

```mermaid
graph TB
    subgraph "NIVEAU 1 - PRESENCA"
        PRESENCA[ğŸ¢ PRESENCA]
        ADMIN_PRESENCA[ğŸ‘¨â€ğŸ’¼ Admin PRESENCA]
    end
    
    subgraph "NIVEAU 2 - ORGANISATIONS"
        subgraph "TYPE RÃ‰SEAU"
            RESEAU[ğŸ˜ï¸ RÃ‰SEAU]
            RESEAU_DIR[ğŸ‘¨â€ğŸ’¼ Direction RÃ©seau]
            RESEAU_AGENCE[ğŸ¢ Agence RÃ©seau]
        end
        
        subgraph "TYPE AGENCE INDÃ‰PENDANTE"
            AGENCE_INDEP[ğŸ¢ Agence IndÃ©pendante]
        end
    end
    
    subgraph "NIVEAU 3 - UTILISATEURS"
        subgraph "RÃ‰SEAU USERS"
            RESP_RESEAU[ğŸ‘¨â€ğŸ’¼ Responsable Agence RÃ©seau]
            COLLAB_RESEAU[ğŸ‘¤ Collaborateur RÃ©seau]
        end
        
        subgraph "AGENCE USERS"
            RESP_AGENCE[ğŸ‘¨â€ğŸ’¼ Responsable Agence IndÃ©p]
            COLLAB_AGENCE[ğŸ‘¤ Collaborateur Agence]
        end
    end
    
    PRESENCA --> RESEAU
    PRESENCA --> AGENCE_INDEP
    RESEAU --> RESEAU_DIR
    RESEAU --> RESEAU_AGENCE
    RESEAU_AGENCE --> RESP_RESEAU
    RESEAU_AGENCE --> COLLAB_RESEAU
    AGENCE_INDEP --> RESP_AGENCE
    AGENCE_INDEP --> COLLAB_AGENCE
```

---

## ğŸ“Š ARCHITECTURE BASE DE DONNÃ‰ES

```mermaid
erDiagram
    auth_users ||--|| users : "1:1"
    users ||--|| utilisateurs : "1:1"
    users }|--|| organisations : "N:1"
    
    organisations ||--o{ reseau : "1:N"
    organisations ||--o{ agence_independante : "1:N"
    
    reseau ||--o{ reseau_direction : "1:N"
    reseau ||--o{ reseau_agence : "1:N"
    
    reseau_agence ||--o{ reseau_agence_responsable : "1:N"
    reseau_agence ||--o{ reseau_agence_collaborateur : "1:N"
    
    agence_independante ||--o{ agence_independante_responsable : "1:N"
    agence_independante ||--o{ agence_independante_collaborateur : "1:N"
    
    utilisateurs ||--o{ reseau_agence_responsable : "1:N"
    utilisateurs ||--o{ reseau_agence_collaborateur : "1:N"
    utilisateurs ||--o{ agence_independante_responsable : "1:N"
    utilisateurs ||--o{ agence_independante_collaborateur : "1:N"
    
    organisations ||--o{ brevo_connexion : "1:1"
    organisations ||--o{ openai_connexion : "1:1"
    organisations ||--o{ linkedin_connexion : "1:1"
    organisations ||--o{ facebook_connexion : "1:1"
    organisations ||--o{ instagram_connexion : "1:1"
    organisations ||--o{ abonnement_stripe : "1:1"
    
    organisations ||--o{ historique_supabase : "1:N"
```

---

## ğŸ” FLUX D'AUTHENTIFICATION

```mermaid
sequenceDiagram
    participant U as Utilisateur
    participant A as App Frontend
    participant S as Supabase Auth
    participant DB as Database
    participant RLS as Row Level Security
    
    U->>A: Connexion (email/password)
    A->>S: auth.signInWithPassword()
    S->>A: Retour auth.users.id
    A->>DB: RequÃªte users via users_auth_id
    DB->>RLS: VÃ©rification organisation_id
    RLS->>DB: Autorisation donnÃ©es org
    DB->>A: Profil utilisateur + permissions
    A->>U: Interface selon rÃ´le/type
```

---

## ğŸ¯ FLUX AGENTS IA

```mermaid
graph LR
    subgraph "DÃ‰CLENCHEMENT"
        USER_ACTION[ğŸ‘¤ Action Utilisateur]
        UI_BUTTON[ğŸ–±ï¸ Clic Agent IA]
    end
    
    subgraph "TRAITEMENT"
        EDGE_FUNC[âš¡ Edge Function]
        IA_LOGIC[ğŸ¤– Logique IA]
        API_CALL[ğŸ“¡ Appel API Externe]
    end
    
    subgraph "STOCKAGE"
        RESULT_DB[(ğŸ’¾ RÃ©sultat DB)]
        AUDIT_LOG[(ğŸ“‹ Log Audit)]
    end
    
    subgraph "RETOUR"
        UI_UPDATE[ğŸ”„ Mise Ã  jour UI]
        NOTIFICATION[ğŸ”” Notification]
    end
    
    USER_ACTION --> UI_BUTTON
    UI_BUTTON --> EDGE_FUNC
    EDGE_FUNC --> IA_LOGIC
    IA_LOGIC --> API_CALL
    API_CALL --> RESULT_DB
    API_CALL --> AUDIT_LOG
    RESULT_DB --> UI_UPDATE
    UI_UPDATE --> NOTIFICATION
```

---

## ğŸ›¡ï¸ SÃ‰CURITÃ‰ RLS

```mermaid
graph TB
    subgraph "POLITIQUES RLS"
        ORG_POLICY[ğŸ¢ organisation_id = get_user_organisation_id()]
        ADMIN_POLICY[ğŸ‘¨â€ğŸ’¼ is_admin_presenca()]
        SELF_POLICY[ğŸ‘¤ user_id = auth.uid()]
    end
    
    subgraph "TABLES PROTÃ‰GÃ‰ES"
        USERS_TABLE[(users)]
        UTILISATEURS_TABLE[(utilisateurs)]
        ORG_TABLE[(organisations)]
        CLIENT_TABLES[(tables clients)]
        CONNEXION_TABLES[(tables connexions)]
    end
    
    ORG_POLICY --> CLIENT_TABLES
    ORG_POLICY --> CONNEXION_TABLES
    ADMIN_POLICY --> ORG_TABLE
    ADMIN_POLICY --> USERS_TABLE
    SELF_POLICY --> UTILISATEURS_TABLE
```

---

## ğŸ“± INTERFACES UTILISATEUR

```mermaid
graph TB
    subgraph "INTERFACE CLIENT-ESPACE"
        CLIENT_DASHBOARD[ğŸ“Š Dashboard Client]
        CLIENT_AGENTS[ğŸ¤– Agents IA]
        CLIENT_STATS[ğŸ“ˆ Statistiques]
        CLIENT_BILLING[ğŸ’³ Facturation]
    end
    
    subgraph "INTERFACE RÃ‰SEAU-ESPACE"
        RESEAU_DASHBOARD[ğŸ“Š Dashboard RÃ©seau]
        RESEAU_AGENCES[ğŸ¢ Gestion Agences]
        RESEAU_STATS[ğŸ“ˆ Stats RÃ©seau]
        RESEAU_BILLING[ğŸ’° Finances RÃ©seau]
    end
    
    subgraph "INTERFACE ADMIN-PRESENCA"
        ADMIN_CLIENTS[ğŸ‘¥ Gestion Clients]
        ADMIN_ORGS[ğŸ¢ Gestion Organisations]
        ADMIN_LOGS[ğŸ“‹ Logs Audit]
        ADMIN_SECURITY[ğŸ”’ SÃ©curitÃ©]
    end
    
    subgraph "AGENTS IA COMMUNS"
        AGENT_ANNONCE[ğŸ“ GÃ©nÃ©ration Annonces]
        AGENT_MARKETING[ğŸ“§ Campagnes Email]
        AGENT_LANDING[ğŸŒ Landing Pages]
        AGENT_SOCIAL[ğŸ“± RÃ©seaux Sociaux]
        AGENT_SOURCING[ğŸ” Sourcing Leads]
    end
    
    CLIENT_AGENTS --> AGENT_ANNONCE
    CLIENT_AGENTS --> AGENT_MARKETING
    CLIENT_AGENTS --> AGENT_LANDING
    CLIENT_AGENTS --> AGENT_SOCIAL
    CLIENT_AGENTS --> AGENT_SOURCING
```

---

## ğŸ’¡ RECOMMANDATIONS

### âœ… Points Forts Actuels
- Architecture multi-tenant bien structurÃ©e
- SÃ©paration claire des rÃ´les et permissions
- SÃ©curitÃ© RLS implÃ©mentÃ©e
- Agents IA spÃ©cialisÃ©s

### âš ï¸ Points d'Attention
- Relations FK Ã  vÃ©rifier entre tables
- Triggers audit Ã  complÃ©ter
- Tests de sÃ©curitÃ© RLS Ã  effectuer
- Documentation technique Ã  synchroniser

### ğŸ¯ Prochaines Ã‰tapes SuggÃ©rÃ©es
1. **Audit Supabase** : VÃ©rifier intÃ©gritÃ© des tables et relations
2. **Tests RLS** : Valider isolation entre organisations  
3. **Documentation** : Finaliser documentation technique
4. **Tests Utilisateur** : Valider parcours complets par rÃ´le

---

**Demandez Ã  OpenAI de crÃ©er un diagramme similaire et nous comparerons nos visions !** ğŸš€
