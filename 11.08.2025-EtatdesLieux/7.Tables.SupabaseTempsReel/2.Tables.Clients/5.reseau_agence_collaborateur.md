# TABLE: reseau_agence_collaborateur

**Date de g√©n√©ration:** 17.08.2025  
**Statut:** ‚úÖ ACTIVE  
**Type:** Table m√©tier - Collaborateurs d'agences r√©seau

---

## üìã STRUCTURE DE LA TABLE

| Colonne | Type | Nullable | D√©faut | Description |
|---------|------|----------|--------|-------------|
| reseau_agence_collaborateur_id | uuid | NO | gen_random_uuid() | üîë Identifiant unique |
| organisation_id | uuid | NO | - | üîó Organisation de rattachement |
| reseau_id | uuid | NO | - | üîó R√©seau parent |
| reseau_agence_id | uuid | NO | - | üîó Agence de rattachement |
| reseau_agence_collaborateur_created_at | timestamp with time zone | NO | now() | Date de cr√©ation |
| reseau_agence_collaborateur_created_by | uuid | YES | - | Cr√©√© par (utilisateur) |
| reseau_agence_collaborateur_updated_at | timestamp with time zone | YES | now() | Date de modification |
| reseau_agence_collaborateur_updated_by | uuid | YES | - | Modifi√© par (utilisateur) |
| reseau_agence_collaborateur_utilisateur_id | uuid | NO | - | üîó R√©f√©rence utilisateur |
| reseau_agence_collaborateur_nom | text | NO | - | Nom du collaborateur |
| reseau_agence_collaborateur_prenom | text | NO | - | Pr√©nom du collaborateur |
| reseau_agence_collaborateur_email | text | NO | - | Email professionnel |
| reseau_agence_collaborateur_telephone | text | NO | - | T√©l√©phone |
| reseau_agence_collaborateur_fonction | text | YES | - | Fonction dans l'agence |
| reseau_agence_collaborateur_date_embauche | timestamp with time zone | YES | now() | Date d'embauche |
| reseau_agence_collaborateur_droits | text | YES | - | Droits et permissions |
| reseau_agence_collaborateur_actif | boolean | NO | true | Statut actif/inactif |
| interdit_acces_admin_presenca | boolean | NO | false | Restriction admin PRESENCA |
| acces_presenca_collab_ag_reseau | boolean | NO | true | Acc√®s plateforme PRESENCA |
| client_type | text | NO | 'reseau_agence' | Type de client |
| client_id | uuid | NO | gen_random_uuid() | ID client g√©n√©rique |
| reseau_agence_collaborateur_audit_log | jsonb | YES | - | Journal d'audit |
| reseau_agence_collaborateur_ia_extensions | jsonb | YES | - | Extensions IA |

---

## ‚ö° TRIGGERS

#### 1. trigger_set_created_audit_fields_reseau_agence_collaborateur
- **Type:** BEFORE INSERT
- **Fonction:** set_created_audit_fields_reseau_agence_collaborateur()
- **Description:** D√©finit les champs d'audit √† la cr√©ation

#### 2. trigger_update_audit_fields_reseau_agence_collaborateur
- **Type:** BEFORE UPDATE
- **Fonction:** update_audit_fields_reseau_agence_collaborateur()
- **Description:** Met √† jour les champs d'audit

---

## üîó RELATIONS ENTRE TABLES (FK)

### Relations sortantes
- **reseau_agence_collaborateur.organisation_id** ‚Üí organisations.organisation_id (implicite)
- **reseau_agence_collaborateur.reseau_id** ‚Üí reseau.reseau_id (implicite)
- **reseau_agence_collaborateur.reseau_agence_id** ‚Üí reseau_agence.reseau_agence_id (implicite)
- **reseau_agence_collaborateur.reseau_agence_collaborateur_utilisateur_id** ‚Üí users.users_id (implicite)

---

## üîß FONCTIONS LI√âES

### Fonctions utilisant cette table
- **set_created_audit_fields_reseau_agence_collaborateur()**: Trigger d'insertion
- **update_audit_fields_reseau_agence_collaborateur()**: Trigger de mise √† jour

---

## üõ°Ô∏è S√âCURIT√â RLS

**RLS Activ√©e:** ‚úÖ OUI  
**RLS Forc√©e:** ‚ùå NON

### Policies RLS

#### 1. admin_presenca_full_access_collaborateur
- **Type:** ALL
- **R√¥les:** authenticated
- **Condition:** `is_admin_presenca(auth.uid())`

#### 2. organisation_only_access_collaborateur
- **Type:** ALL
- **R√¥les:** authenticated
- **Condition:** `organisation_id = get_user_organisation_id(auth.uid())`

---

## üéØ NOTES TECHNIQUES

### Int√©gration
- **Hi√©rarchie compl√®te**: Organisation > R√©seau > Agence > Collaborateur
- **Bridge utilisateur**: Lien avec table users via utilisateur_id
- **Isolation stricte**: Par organisation via RLS

### Performance
- Index automatique sur PK (reseau_agence_collaborateur_id)
- Relations optimis√©es avec organisation_id, reseau_id et reseau_agence_id

*Documentation g√©n√©r√©e automatiquement le 17.08.2025*