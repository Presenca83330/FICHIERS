# TABLE: reseau_direction

**Date de g√©n√©ration:** 17.08.2025  
**Statut:** ‚úÖ ACTIVE  
**Type:** Table m√©tier - Direction r√©seau

---

## üìã STRUCTURE DE LA TABLE

| Colonne | Type | Nullable | D√©faut | Description |
|---------|------|----------|--------|-------------|
| reseau_direction_id | uuid | NO | gen_random_uuid() | üîë Identifiant unique |
| organisation_id | uuid | NO | - | üîó Organisation de rattachement |
| reseau_id | uuid | NO | - | üîó R√©seau parent |
| reseau_direction_created_at | timestamp with time zone | NO | now() | Date de cr√©ation |
| reseau_direction_created_by | uuid | YES | - | Cr√©√© par (utilisateur) |
| reseau_direction_updated_at | timestamp with time zone | YES | now() | Date de modification |
| reseau_direction_updated_by | uuid | YES | - | Modifi√© par (utilisateur) |
| reseau_direction_utilisateur_id | uuid | NO | - | üîó R√©f√©rence utilisateur |
| reseau_direction_nom | text | NO | - | Nom du dirigeant |
| reseau_direction_prenom | text | NO | - | Pr√©nom du dirigeant |
| reseau_direction_email | text | NO | - | Email professionnel |
| reseau_direction_telephone | text | NO | - | T√©l√©phone |
| reseau_direction_fonction | text | YES | - | Fonction dans l'organisation |
| reseau_direction_date_nomination | timestamp with time zone | YES | now() | Date de nomination |
| reseau_direction_actif | boolean | NO | true | Statut actif/inactif |
| reseau_direction_espace_client | boolean | NO | true | Acc√®s espace client |
| interdit_acces_admin_presenca | boolean | NO | true | Restriction admin PRESENCA |
| acces_presenca_direction | boolean | NO | true | Acc√®s plateforme PRESENCA |
| client_type | text | NO | 'reseau' | Type de client |
| client_id | uuid | NO | gen_random_uuid() | ID client g√©n√©rique |
| reseau_direction_audit_log | jsonb | YES | - | Journal d'audit |
| reseau_direction_ia_extensions | jsonb | YES | - | Extensions IA |

---

## üîß D√âFINITION SQL COMPL√àTE

```sql
/* SQL Definition generated from catalogs */
/* Owner: postgres | Tablespace: pg_default | RLS: enabled */

CREATE TABLE public.reseau_direction (
  reseau_direction_id uuid NOT NULL DEFAULT gen_random_uuid(),
  organisation_id uuid NOT NULL,
  reseau_id uuid NOT NULL,
  reseau_direction_created_at timestamp with time zone NOT NULL DEFAULT now(),
  reseau_direction_created_by uuid,
  reseau_direction_updated_at timestamp with time zone DEFAULT now(),
  reseau_direction_updated_by uuid,
  reseau_direction_utilisateur_id uuid NOT NULL,
  reseau_direction_nom text NOT NULL,
  reseau_direction_prenom text NOT NULL,
  reseau_direction_email text NOT NULL,
  reseau_direction_telephone text NOT NULL,
  reseau_direction_fonction text,
  reseau_direction_date_nomination timestamp with time zone DEFAULT now(),
  reseau_direction_actif boolean NOT NULL DEFAULT true,
  reseau_direction_espace_client boolean NOT NULL DEFAULT true,
  interdit_acces_admin_presenca boolean NOT NULL DEFAULT true,
  acces_presenca_direction boolean NOT NULL DEFAULT true,
  client_type text NOT NULL DEFAULT 'reseau'::text,
  client_id uuid NOT NULL DEFAULT gen_random_uuid(),
  reseau_direction_audit_log jsonb,
  reseau_direction_ia_extensions jsonb,
  CONSTRAINT fk_reseau_direction_reseau FOREIGN KEY (reseau_id) REFERENCES reseau(reseau_id) ON DELETE CASCADE,
  CONSTRAINT reseau_direction_client_type_check CHECK (client_type = 'reseau'::text),
  CONSTRAINT reseau_direction_organisation_id_fkey FOREIGN KEY (organisation_id) REFERENCES organisations(organisation_id) ON DELETE CASCADE,
  CONSTRAINT reseau_direction_pkey PRIMARY KEY (reseau_direction_id),
  CONSTRAINT reseau_direction_reseau_direction_created_by_fkey FOREIGN KEY (reseau_direction_created_by) REFERENCES users(users_id) ON DELETE SET NULL,
  CONSTRAINT reseau_direction_reseau_direction_email_key UNIQUE (reseau_direction_email),
  CONSTRAINT reseau_direction_reseau_direction_updated_by_fkey FOREIGN KEY (reseau_direction_updated_by) REFERENCES users(users_id) ON DELETE SET NULL,
  CONSTRAINT reseau_direction_reseau_direction_utilisateur_id_fkey FOREIGN KEY (reseau_direction_utilisateur_id) REFERENCES users(users_id) ON DELETE CASCADE
);
```

---

## üóÇÔ∏è CONTRAINTES

### Cl√©s primaires et √©trang√®res
- **PRIMARY KEY**: reseau_direction_pkey (reseau_direction_id)
- **FOREIGN KEY**: fk_reseau_direction_reseau ‚Üí reseau(reseau_id)
- **FOREIGN KEY**: reseau_direction_organisation_id_fkey ‚Üí organisations(organisation_id)
- **FOREIGN KEY**: reseau_direction_reseau_direction_created_by_fkey ‚Üí users(users_id)
- **FOREIGN KEY**: reseau_direction_reseau_direction_updated_by_fkey ‚Üí users(users_id)
- **FOREIGN KEY**: reseau_direction_reseau_direction_utilisateur_id_fkey ‚Üí users(users_id)
- **UNIQUE**: reseau_direction_reseau_direction_email_key (reseau_direction_email)

### Contraintes CHECK
- **reseau_direction_client_type_check**: client_type = 'reseau'

---

## üìà INDEX

- **reseau_direction_pkey**: PRIMARY KEY UNIQUE INDEX sur reseau_direction_id
- **reseau_direction_reseau_direction_email_key**: UNIQUE INDEX sur reseau_direction_email

---

## ‚ö° TRIGGERS

#### 1. trigger_set_created_audit_fields_reseau_direction
- **Type:** BEFORE INSERT
- **Fonction:** set_created_audit_fields_reseau_direction()
- **Description:** D√©finit automatiquement les champs d'audit √† la cr√©ation

#### 2. trigger_update_audit_fields_reseau_direction
- **Type:** BEFORE UPDATE
- **Fonction:** update_audit_fields_reseau_direction()
- **Description:** Met √† jour reseau_direction_updated_at et reseau_direction_updated_by

---

## üîó RELATIONS ENTRE TABLES (FK)

### Relations sortantes
- **reseau_direction.organisation_id** ‚Üí organisations.organisation_id
- **reseau_direction.reseau_id** ‚Üí reseau.reseau_id
- **reseau_direction.reseau_direction_created_by** ‚Üí users.users_id
- **reseau_direction.reseau_direction_updated_by** ‚Üí users.users_id
- **reseau_direction.reseau_direction_utilisateur_id** ‚Üí users.users_id

---

## üõ°Ô∏è S√âCURIT√â RLS

**RLS Activ√©e:** ‚úÖ OUI  
**RLS Forc√©e:** ‚ùå NON

### Policies RLS

#### 1. admin_presenca_full_access_reseau_direction
- **Type:** ALL
- **R√¥les:** public
- **Condition:** `is_admin_presenca(auth.uid())`

#### 2. organisation_only_access_reseau_direction
- **Type:** ALL
- **R√¥les:** public
- **Condition:** `organisation_id = get_user_organisation_id(auth.uid())`

---

## üîß FONCTIONS LI√âES

### Fonctions utilisant cette table
- **set_created_audit_fields_reseau_direction()**: Trigger d'insertion
- **update_audit_fields_reseau_direction()**: Trigger de mise √† jour

---

## üéØ NOTES TECHNIQUES

### Int√©gration
- **Hi√©rarchie**: Organisation > R√©seau > Direction
- **Bridge utilisateur**: Lien avec table users via reseau_direction_utilisateur_id
- **Isolation stricte**: Par organisation via RLS

### S√©curit√©
- **Email unique**: Contrainte d'unicit√© sur reseau_direction_email
- **Audit complet**: created_by/updated_by avec FK vers users
- **Acc√®s contr√¥l√©**: Flags pour espace client et admin PRESENCA
- **Restriction par d√©faut**: interdit_acces_admin_presenca = true

### Performance
- **Index unique** sur email
- **Relations optimis√©es** avec reseau, organisation et users
- **Cascade DELETE** depuis reseau et organisation

### Business Logic
- **Direction sp√©cialis√©e**: Table d√©di√©e aux dirigeants de r√©seau
- **Nomination track√©e**: Date de nomination automatique
- **Statut actif/inactif**: Gestion de l'√©tat du dirigeant
- **Extensions IA**: Support pour fonctionnalit√©s futures

*Documentation g√©n√©r√©e automatiquement le 17.08.2025*