# TABLE: agence_independante

**Date de gÃ©nÃ©ration:** 17.08.2025  
**Statut:** âœ… ACTIVE  
**Type:** Table mÃ©tier - Agences indÃ©pendantes

---

## ğŸ“‹ STRUCTURE DE LA TABLE

| Colonne | Type | Nullable | DÃ©faut | Description |
|---------|------|----------|--------|-------------|
| agence_indep_id | uuid | NO | gen_random_uuid() | ğŸ”‘ Identifiant unique |
| organisation_id | uuid | NO | - | ğŸ”— Organisation de rattachement |
| agence_indep_created_at | timestamp with time zone | NO | now() | Date de crÃ©ation |
| agence_indep_created_by | uuid | YES | - | CrÃ©Ã© par (utilisateur) |
| agence_indep_updated_at | timestamp with time zone | YES | now() | Date de modification |
| agence_indep_updated_by | uuid | YES | - | ModifiÃ© par (utilisateur) |
| agence_indep_nom | text | NO | - | Nom de l'agence |
| agence_indep_identite_commerciale | text | YES | - | Nom commercial |
| agence_indep_adresse | text | NO | - | Adresse complÃ¨te |
| agence_indep_code_postal | text | NO | - | Code postal |
| agence_indep_ville | text | NO | - | Ville |
| agence_indep_telephone | text | NO | - | TÃ©lÃ©phone |
| agence_indep_email | text | NO | - | Email principal |
| agence_indep_siret | text | NO | - | NumÃ©ro SIRET |
| agence_indep_inscription | timestamp with time zone | NO | now() | Date d'inscription |
| agence_indep_date_debut_abonnement | timestamp with time zone | YES | - | DÃ©but abonnement |
| agence_indep_date_resiliation_abonnement | timestamp with time zone | YES | - | Fin abonnement |
| agence_indep_statut_abonnement | text | YES | - | Statut abonnement |
| agence_indep_plan | text | YES | - | Plan souscrit |
| agence_indep_statut_paiement | text | YES | - | Statut paiement |
| agence_indep_abonnement_id | uuid | YES | - | ğŸ”— RÃ©fÃ©rence abonnement |
| agence_indep_linkedin_connexion_id | uuid | YES | - | ğŸ”— Connexion LinkedIn |
| agence_indep_facebook_connexion_id | uuid | YES | - | ğŸ”— Connexion Facebook |
| agence_indep_instagram_connexion_id | uuid | YES | - | ğŸ”— Connexion Instagram |
| agence_indep_brevo_connexion_id | uuid | YES | - | ğŸ”— Connexion Brevo |
| agence_indep_zoho_connexion_id | uuid | YES | - | ğŸ”— Connexion Zoho |
| agence_indep_openai_connexion_id | uuid | YES | - | ğŸ”— Connexion OpenAI |
| client_type | text | NO | 'agence_independante' | Type de client |
| client_id | uuid | NO | gen_random_uuid() | ID client gÃ©nÃ©rique |
| agence_indep_logo | text | YES | - | Logo de l'agence |
| agence_indep_ressources | ARRAY | YES | - | Ressources disponibles |
| agence_indep_espace_client | boolean | NO | true | AccÃ¨s espace client |
| interdit_acces_admin_presenca | boolean | NO | false | Restriction admin PRESENCA |
| acces_presenca_ag_indep | boolean | NO | true | AccÃ¨s plateforme PRESENCA |
| agence_indep_statut | text | NO | 'actif' | Statut de l'agence |
| agence_indep_audit_log | jsonb | YES | - | Journal d'audit |
| agence_indep_ia_extensions | jsonb | YES | - | Extensions IA |

---

## âš¡ TRIGGERS

#### 1. trigger_set_created_audit_fields_agence_independante
- **Type:** BEFORE INSERT
- **Fonction:** set_created_audit_fields_agence_independante()
- **Description:** DÃ©finit les champs d'audit Ã  la crÃ©ation

#### 2. trigger_update_audit_fields_agence_independante
- **Type:** BEFORE UPDATE
- **Fonction:** update_audit_fields_agence_independante()
- **Description:** Met Ã  jour les champs d'audit

---

## ğŸ”— RELATIONS ENTRE TABLES (FK)

### Relations sortantes
- **agence_independante.organisation_id** â†’ organisations.organisation_id (implicite)

### Relations entrantes
- agence_independante_responsable.agence_indep_id â† agence_independante.agence_indep_id
- agence_independante_collaborateur.agence_indep_id â† agence_independante.agence_indep_id

---

## ğŸ”§ FONCTIONS LIÃ‰ES

### Fonctions utilisant cette table
- **set_created_audit_fields_agence_independante()**: Trigger d'insertion
- **update_audit_fields_agence_independante()**: Trigger de mise Ã  jour
- **get_organisation_type()**: DÃ©termine le type d'organisation

---

## ğŸ›¡ï¸ SÃ‰CURITÃ‰ RLS

**RLS ActivÃ©e:** âœ… OUI  
**RLS ForcÃ©e:** âŒ NON

### Policies RLS

#### 1. admin_presenca_full_access_agence_indep
- **Type:** ALL
- **RÃ´les:** authenticated
- **Condition:** `is_admin_presenca(auth.uid())`

#### 2. organisation_only_access_agence_indep
- **Type:** ALL
- **RÃ´les:** authenticated
- **Condition:** `organisation_id = get_user_organisation_id(auth.uid())`

---

## ğŸ¯ NOTES TECHNIQUES

### IntÃ©gration
- **EntitÃ© autonome**: Agence indÃ©pendante sans hiÃ©rarchie rÃ©seau
- **Multi-connexions**: Liens vers toutes les API (Social Media, CRM, IA)
- **Abonnement direct**: Gestion financiÃ¨re indÃ©pendante

### Performance
- Index automatique sur PK (agence_indep_id)
- Relations optimisÃ©es avec organisation_id

*Documentation gÃ©nÃ©rÃ©e automatiquement le 17.08.2025*