# TABLE: agence_independante

**Date de génération:** 17.08.2025  
**Statut:** ✅ ACTIVE  
**Type:** Table métier - Agences indépendantes

---

## 📋 STRUCTURE DE LA TABLE

| Colonne | Type | Nullable | Défaut | Description |
|---------|------|----------|--------|-------------|
| agence_indep_id | uuid | NO | gen_random_uuid() | 🔑 Identifiant unique |
| organisation_id | uuid | NO | - | 🔗 Organisation de rattachement |
| agence_indep_created_at | timestamp with time zone | NO | now() | Date de création |
| agence_indep_created_by | uuid | YES | - | Créé par (utilisateur) |
| agence_indep_updated_at | timestamp with time zone | YES | now() | Date de modification |
| agence_indep_updated_by | uuid | YES | - | Modifié par (utilisateur) |
| agence_indep_nom | text | NO | - | Nom de l'agence |
| agence_indep_identite_commerciale | text | YES | - | Nom commercial |
| agence_indep_adresse | text | NO | - | Adresse complète |
| agence_indep_code_postal | text | NO | - | Code postal |
| agence_indep_ville | text | NO | - | Ville |
| agence_indep_telephone | text | NO | - | Téléphone |
| agence_indep_email | text | NO | - | Email principal |
| agence_indep_siret | text | NO | - | Numéro SIRET |
| agence_indep_inscription | timestamp with time zone | NO | now() | Date d'inscription |
| agence_indep_date_debut_abonnement | timestamp with time zone | YES | - | Début abonnement |
| agence_indep_date_resiliation_abonnement | timestamp with time zone | YES | - | Fin abonnement |
| agence_indep_statut_abonnement | text | YES | - | Statut abonnement |
| agence_indep_plan | text | YES | - | Plan souscrit |
| agence_indep_statut_paiement | text | YES | - | Statut paiement |
| agence_indep_abonnement_id | uuid | YES | - | 🔗 Référence abonnement |
| agence_indep_linkedin_connexion_id | uuid | YES | - | 🔗 Connexion LinkedIn |
| agence_indep_facebook_connexion_id | uuid | YES | - | 🔗 Connexion Facebook |
| agence_indep_instagram_connexion_id | uuid | YES | - | 🔗 Connexion Instagram |
| agence_indep_brevo_connexion_id | uuid | YES | - | 🔗 Connexion Brevo |
| agence_indep_zoho_connexion_id | uuid | YES | - | 🔗 Connexion Zoho |
| agence_indep_openai_connexion_id | uuid | YES | - | 🔗 Connexion OpenAI |
| client_type | text | NO | 'agence_independante' | Type de client |
| client_id | uuid | NO | gen_random_uuid() | ID client générique |
| agence_indep_logo | text | YES | - | Logo de l'agence |
| agence_indep_ressources | ARRAY | YES | - | Ressources disponibles |
| agence_indep_espace_client | boolean | NO | true | Accès espace client |
| interdit_acces_admin_presenca | boolean | NO | false | Restriction admin PRESENCA |
| acces_presenca_ag_indep | boolean | NO | true | Accès plateforme PRESENCA |
| agence_indep_statut | text | NO | 'actif' | Statut de l'agence |
| agence_indep_audit_log | jsonb | YES | - | Journal d'audit |
| agence_indep_ia_extensions | jsonb | YES | - | Extensions IA |

---

## ⚡ TRIGGERS

#### 1. trigger_set_created_audit_fields_agence_independante
- **Type:** BEFORE INSERT
- **Fonction:** set_created_audit_fields_agence_independante()
- **Description:** Définit les champs d'audit à la création

#### 2. trigger_update_audit_fields_agence_independante
- **Type:** BEFORE UPDATE
- **Fonction:** update_audit_fields_agence_independante()
- **Description:** Met à jour les champs d'audit

---

## 🔗 RELATIONS ENTRE TABLES (FK)

### Relations sortantes
- **agence_independante.organisation_id** → organisations.organisation_id (implicite)

### Relations entrantes
- agence_independante_responsable.agence_indep_id ← agence_independante.agence_indep_id
- agence_independante_collaborateur.agence_indep_id ← agence_independante.agence_indep_id

---

## 🔧 FONCTIONS LIÉES

### Fonctions utilisant cette table
- **set_created_audit_fields_agence_independante()**: Trigger d'insertion
- **update_audit_fields_agence_independante()**: Trigger de mise à jour
- **get_organisation_type()**: Détermine le type d'organisation

---

## 🛡️ SÉCURITÉ RLS

**RLS Activée:** ✅ OUI  
**RLS Forcée:** ❌ NON

### Policies RLS

#### 1. admin_presenca_full_access_agence_indep
- **Type:** ALL
- **Rôles:** authenticated
- **Condition:** `is_admin_presenca(auth.uid())`

#### 2. organisation_only_access_agence_indep
- **Type:** ALL
- **Rôles:** authenticated
- **Condition:** `organisation_id = get_user_organisation_id(auth.uid())`

---

## 🎯 NOTES TECHNIQUES

### Intégration
- **Entité autonome**: Agence indépendante sans hiérarchie réseau
- **Multi-connexions**: Liens vers toutes les API (Social Media, CRM, IA)
- **Abonnement direct**: Gestion financière indépendante

### Performance
- Index automatique sur PK (agence_indep_id)
- Relations optimisées avec organisation_id

*Documentation générée automatiquement le 17.08.2025*