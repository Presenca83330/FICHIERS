# TABLE: reseau_agence

**Date de génération:** 17.08.2025  
**Statut:** ✅ ACTIVE  
**Type:** Table métier - Agences de réseau

---

## 📋 STRUCTURE DE LA TABLE

| Colonne | Type | Nullable | Défaut | Description |
|---------|------|----------|--------|-------------|
| reseau_agence_id | uuid | NO | gen_random_uuid() | 🔑 Identifiant unique |
| organisation_id | uuid | NO | - | 🔗 Organisation de rattachement |
| reseau_id | uuid | NO | - | 🔗 Réseau parent |
| reseau_agence_created_at | timestamp with time zone | NO | now() | Date de création |
| reseau_agence_created_by | uuid | YES | - | Créé par (utilisateur) |
| reseau_agence_updated_at | timestamp with time zone | YES | now() | Date de modification |
| reseau_agence_updated_by | uuid | YES | - | Modifié par (utilisateur) |
| reseau_agence_nom | text | NO | - | Nom de l'agence |
| reseau_agence_identite_commerciale | text | YES | - | Nom commercial |
| reseau_agence_adresse | text | NO | - | Adresse complète |
| reseau_agence_code_postal | text | NO | - | Code postal |
| reseau_agence_ville | text | NO | - | Ville |
| reseau_agence_telephone | text | NO | - | Téléphone |
| reseau_agence_email | text | NO | - | Email principal |
| reseau_agence_siret | text | NO | - | Numéro SIRET |
| reseau_agence_inscription | timestamp with time zone | NO | now() | Date d'inscription |
| reseau_agence_date_debut_abonnement | timestamp with time zone | YES | - | Début abonnement |
| reseau_agence_date_resiliation_abonnement | timestamp with time zone | YES | - | Fin abonnement |
| reseau_agence_statut_abonnement | text | YES | - | Statut abonnement |
| reseau_agence_plan | text | YES | - | Plan souscrit |
| reseau_agence_statut_paiement | text | YES | - | Statut paiement |
| reseau_agence_abonnement_id | uuid | YES | - | 🔗 Référence abonnement |
| reseau_agence_linkedin_connexion_id | uuid | YES | - | 🔗 Connexion LinkedIn |
| reseau_agence_facebook_connexion_id | uuid | YES | - | 🔗 Connexion Facebook |
| reseau_agence_instagram_connexion_id | uuid | YES | - | 🔗 Connexion Instagram |
| reseau_brevo_connexion_id | uuid | YES | - | 🔗 Connexion Brevo |
| reseau_zoho_connexion_id | uuid | YES | - | 🔗 Connexion Zoho |
| reseau_openai_connexion_id | uuid | YES | - | 🔗 Connexion OpenAI |
| client_type | text | NO | 'reseau_agence' | Type de client |
| client_id | uuid | NO | gen_random_uuid() | ID client générique |
| reseau_agence_logo | text | YES | - | Logo de l'agence |
| reseau_agence_ressources | ARRAY | YES | - | Ressources disponibles |
| reseau_agence_espace_client | boolean | NO | true | Accès espace client |
| interdit_acces_admin_presenca | boolean | NO | false | Restriction admin PRESENCA |
| acces_presenca_agence | boolean | NO | true | Accès plateforme PRESENCA |
| reseau_agence_statut | text | NO | 'actif' | Statut de l'agence |
| reseau_agence_audit_log | jsonb | YES | - | Journal d'audit |
| reseau_agence_ia_extensions | jsonb | YES | - | Extensions IA |

---

## 🔧 DÉFINITION SQL COMPLÈTE

```sql
/* SQL Definition generated from catalogs */
/* Owner: postgres | Tablespace: pg_default | RLS: enabled */

CREATE TABLE public.reseau_agence (
  reseau_agence_id uuid NOT NULL DEFAULT gen_random_uuid(),
  organisation_id uuid NOT NULL,
  reseau_id uuid NOT NULL,
  reseau_agence_created_at timestamp with time zone NOT NULL DEFAULT now(),
  reseau_agence_created_by uuid,
  reseau_agence_updated_at timestamp with time zone DEFAULT now(),
  reseau_agence_updated_by uuid,
  reseau_agence_nom text NOT NULL,
  reseau_agence_identite_commerciale text,
  reseau_agence_adresse text NOT NULL,
  reseau_agence_code_postal text NOT NULL,
  reseau_agence_ville text NOT NULL,
  reseau_agence_telephone text NOT NULL,
  reseau_agence_email text NOT NULL,
  reseau_agence_siret text NOT NULL,
  reseau_agence_inscription timestamp with time zone NOT NULL DEFAULT now(),
  reseau_agence_date_debut_abonnement timestamp with time zone,
  reseau_agence_date_resiliation_abonnement timestamp with time zone,
  reseau_agence_abonnement_id uuid,
  reseau_agence_plan text,
  reseau_agence_statut_abonnement text,
  reseau_agence_statut_paiement text,
  reseau_agence_statut text NOT NULL DEFAULT 'actif'::text,
  reseau_agence_logo text,
  reseau_agence_ressources text[],
  reseau_agence_espace_client boolean NOT NULL DEFAULT true,
  interdit_acces_admin_presenca boolean NOT NULL DEFAULT false,
  acces_presenca_agence boolean NOT NULL DEFAULT true,
  client_type text NOT NULL DEFAULT 'reseau_agence'::text,
  client_id uuid NOT NULL DEFAULT gen_random_uuid(),
  reseau_brevo_connexion_id uuid,
  reseau_agence_linkedin_connexion_id uuid,
  reseau_agence_facebook_connexion_id uuid,
  reseau_agence_instagram_connexion_id uuid,
  reseau_zoho_connexion_id uuid,
  reseau_openai_connexion_id uuid,
  reseau_agence_audit_log jsonb,
  reseau_agence_ia_extensions jsonb,
  CONSTRAINT reseau_agence_pkey PRIMARY KEY (reseau_agence_id)
);
```

---

## ⚡ TRIGGERS

#### 1. trigger_set_created_audit_fields_reseau_agence
- **Type:** BEFORE INSERT
- **Fonction:** set_created_audit_fields_reseau_agence()
- **Description:** Définit les champs d'audit à la création

#### 2. trigger_update_audit_fields_reseau_agence
- **Type:** BEFORE UPDATE
- **Fonction:** update_audit_fields_reseau_agence()
- **Description:** Met à jour les champs d'audit

---

## 🔗 RELATIONS ENTRE TABLES (FK)

### Relations sortantes
- **reseau_agence.organisation_id** → organisations.organisation_id (implicite)
- **reseau_agence.reseau_id** → reseau.reseau_id (implicite)
- **reseau_agence.reseau_agence_abonnement_id** → abonnement_stripe.abonnement_id (implicite)

### Relations entrantes
- reseau_agence_responsable.reseau_agence_id ← reseau_agence.reseau_agence_id
- reseau_agence_collaborateur.reseau_agence_id ← reseau_agence.reseau_agence_id

---

## 🔧 FONCTIONS LIÉES

### Fonctions utilisant cette table
- **set_created_audit_fields_reseau_agence()**: Trigger d'insertion
- **update_audit_fields_reseau_agence()**: Trigger de mise à jour

---