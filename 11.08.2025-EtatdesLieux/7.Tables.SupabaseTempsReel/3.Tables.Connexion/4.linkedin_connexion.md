# TABLE: linkedin_connexion

**Date de g√©n√©ration:** 17.08.2025  
**Statut:** ‚úÖ ACTIVE  
**Type:** Table technique - Connexions API LinkedIn

---

## üìã STRUCTURE DE LA TABLE

| Colonne | Type | Nullable | D√©faut | Description |
|---------|------|----------|--------|-------------|
| linkedin_connexion_id | uuid | NO | gen_random_uuid() | üîë Identifiant unique |
| organisation_id | uuid | NO | - | üîó Organisation de rattachement |
| client_type | text | NO | 'reseau'::text | Type de client |
| client_id | uuid | NO | - | üîó R√©f√©rence client |
| linkedin_connexion_key | text | NO | - | Cl√© de connexion |
| linkedin_email_compte | text | NO | - | Email du compte LinkedIn |
| linkedin_access_token | text | YES | - | Token d'acc√®s OAuth |
| linkedin_refresh_token | text | YES | - | Token de rafra√Æchissement |
| linkedin_token_expire_at | timestamp with time zone | YES | - | Date d'expiration token |
| linkedin_actif | boolean | NO | true | Connexion active |
| linkedin_date_activation | timestamp with time zone | NO | now() | Date d'activation |
| linkedin_derniere_synchro | timestamp with time zone | YES | - | Derni√®re synchronisation |
| linkedin_statut_connexion | text | NO | 'active'::text | Statut de la connexion |
| linkedin_derniere_erreur | text | YES | - | Derni√®re erreur rencontr√©e |
| linkedin_limite_quotidienne | integer | YES | - | Limite d'appels API |
| linkedin_usage_quotidien | integer | YES | 0 | Usage quotidien actuel |
| linkedin_reset_quota_at | timestamp with time zone | YES | - | Remise √† z√©ro du quota |
| linkedin_profil_entreprise_id | text | YES | - | ID du profil entreprise |
| linkedin_permissions | text[] | YES | '{r_liteprofile,r_emailaddress,w_member_social}'::text[] | Permissions OAuth |
| linkedin_created_at | timestamp with time zone | NO | now() | Date de cr√©ation |
| linkedin_created_by | uuid | YES | - | Cr√©√© par (utilisateur) |
| linkedin_updated_at | timestamp with time zone | NO | now() | Date de modification |
| linkedin_updated_by | uuid | YES | - | Modifi√© par (utilisateur) |
| linkedin_audit_log | jsonb | YES | '{}'::jsonb | Journal d'audit |
| linkedin_ia_extensions | jsonb | YES | '{}'::jsonb | Extensions IA |

---

## üîç CONTRAINTES

### Contraintes CHECK
- `linkedin_connexion_client_type_check` : Type limit√© √† 'reseau', 'reseau_agence', 'agence_independante'
- `linkedin_connexion_linkedin_statut_connexion_check` : Statut limit√© √† 'active', 'inactive', 'error', 'expired', 'unauthorized'

### Contraintes FK
- `linkedin_connexion_organisation_id_fkey` : R√©f√©rence vers organisations(organisation_id) ON DELETE CASCADE
- `linkedin_connexion_linkedin_created_by_fkey` : R√©f√©rence vers users(users_id) ON DELETE SET NULL
- `linkedin_connexion_linkedin_updated_by_fkey` : R√©f√©rence vers users(users_id) ON DELETE SET NULL

---

## üìä INDEX

- `linkedin_connexion_pkey` : UNIQUE BTREE (linkedin_connexion_id)

---

## ‚ö° TRIGGERS

### 1. trigger_set_created_audit_fields_linkedin_connexion
- **Type:** BEFORE INSERT
- **Fonction:** set_created_audit_fields_linkedin_connexion()
- **Description:** D√©finit les champs d'audit √† la cr√©ation

### 2. trigger_update_audit_fields_linkedin_connexion
- **Type:** BEFORE UPDATE
- **Fonction:** update_audit_fields_linkedin_connexion()
- **Description:** Met √† jour les champs d'audit

---

## üõ°Ô∏è S√âCURIT√â RLS

**RLS Activ√©e:** ‚úÖ OUI  
**RLS Forc√©e:** ‚ùå NON

### Policies RLS

#### 1. admin_presenca_full_access_linkedin_connexion
- **Type:** ALL
- **R√¥les:** public
- **Condition:** `is_admin_presenca(auth.uid())`

#### 2. organisation_only_access_linkedin_connexion
- **Type:** ALL
- **R√¥les:** public
- **Condition:** `organisation_id = get_user_organisation_id(auth.uid())`

---

## üìù D√âFINITION SQL COMPL√àTE

```sql
CREATE TABLE public.linkedin_connexion (
  linkedin_connexion_id uuid NOT NULL DEFAULT gen_random_uuid(),
  organisation_id uuid NOT NULL,
  client_type text NOT NULL DEFAULT 'reseau'::text,
  client_id uuid NOT NULL,
  linkedin_connexion_key text NOT NULL,
  linkedin_email_compte text NOT NULL,
  linkedin_access_token text,
  linkedin_refresh_token text,
  linkedin_token_expire_at timestamp with time zone,
  linkedin_actif boolean NOT NULL DEFAULT true,
  linkedin_date_activation timestamp with time zone NOT NULL DEFAULT now(),
  linkedin_derniere_synchro timestamp with time zone,
  linkedin_statut_connexion text NOT NULL DEFAULT 'active'::text,
  linkedin_derniere_erreur text,
  linkedin_limite_quotidienne integer,
  linkedin_usage_quotidien integer DEFAULT 0,
  linkedin_reset_quota_at timestamp with time zone,
  linkedin_profil_entreprise_id text,
  linkedin_permissions text[] DEFAULT '{r_liteprofile,r_emailaddress,w_member_social}'::text[],
  linkedin_created_at timestamp with time zone NOT NULL DEFAULT now(),
  linkedin_created_by uuid,
  linkedin_updated_at timestamp with time zone NOT NULL DEFAULT now(),
  linkedin_updated_by uuid,
  linkedin_audit_log jsonb DEFAULT '{}'::jsonb,
  linkedin_ia_extensions jsonb DEFAULT '{}'::jsonb
);
```

---

## üéØ NOTES TECHNIQUES

### Int√©gration
- **API LinkedIn** : Gestion des profils et publications professionnelles
- **OAuth** : Tokens d'acc√®s et de rafra√Æchissement s√©curis√©s
- **Multi-client** : Support r√©seau, agences r√©seau et agences ind√©pendantes

### S√©curit√©
- **Stockage s√©curis√©** : Tokens OAuth chiffr√©s
- **Isolation organisation** : RLS par organisation
- **Monitoring** : Quotas API LinkedIn surveill√©s

*Documentation g√©n√©r√©e automatiquement le 17.08.2025*