# TABLE: openai_connexion

**Date de g√©n√©ration:** 17.08.2025  
**Statut:** ‚úÖ ACTIF  
**Type:** Table technique - Connexions API OpenAI

---

## üìã STRUCTURE DE LA TABLE

| Colonne | Type | Nullable | D√©faut | Description |
|---------|------|----------|--------|-------------|
| openai_connexion_id | uuid | NO | gen_random_uuid() | üîë Identifiant unique |
| organisation_id | uuid | NO | - | üîó Organisation de rattachement |
| client_type | text | NO | 'reseau' | Type de client |
| client_id | uuid | NO | - | üîó R√©f√©rence client |
| openai_api_key | text | NO | - | üîê Cl√© API OpenAI |
| openai_email_compte | text | NO | - | Email du compte OpenAI |
| openai_organisation_id | text | YES | - | ID organisation OpenAI |
| openai_project_id | text | YES | - | ID projet OpenAI |
| openai_actif | boolean | NO | true | Statut actif/inactif |
| openai_date_activation | timestamp with time zone | NO | now() | Date d'activation |
| openai_derniere_synchro | timestamp with time zone | YES | - | Derni√®re synchronisation |
| openai_statut_connexion | text | NO | 'active' | Statut de la connexion |
| openai_derniere_erreur | text | YES | - | Derni√®re erreur rencontr√©e |
| openai_limite_quotidienne | integer | YES | - | Limite quotidienne API |
| openai_usage_quotidien | integer | YES | 0 | Usage quotidien actuel |
| openai_reset_quota_at | timestamp with time zone | YES | - | Reset du quota |
| openai_modeles_autorises | text[] | YES | '{gpt-3.5-turbo,gpt-4}' | Mod√®les autoris√©s |
| openai_cout_actuel_mois | numeric | YES | 0.0000 | Co√ªt actuel du mois |
| openai_limite_cout_mois | numeric | YES | NULL | Limite de co√ªt mensuel |
| openai_created_at | timestamp with time zone | NO | now() | Date de cr√©ation |
| openai_created_by | uuid | YES | - | Cr√©√© par (utilisateur) |
| openai_updated_at | timestamp with time zone | NO | now() | Date de modification |
| openai_updated_by | uuid | YES | - | Modifi√© par (utilisateur) |
| openai_audit_log | jsonb | YES | '{}' | Journal d'audit |
| openai_ia_extensions | jsonb | YES | '{}' | Extensions IA |

---

## üõ°Ô∏è S√âCURIT√â RLS

**RLS Activ√©e:** ‚úÖ OUI  
**RLS Forc√©e:** ‚ùå NON

### Policies RLS

#### 1. admin_presenca_full_access_openai_connexion
- **Type:** ALL
- **R√¥les:** public
- **Condition:** `is_admin_presenca(auth.uid())`

#### 2. organisation_only_access_openai_connexion
- **Type:** ALL
- **R√¥les:** public
- **Condition:** `organisation_id = get_user_organisation_id(auth.uid())`

---

## üîó RELATIONS

### Cl√©s √©trang√®res sortantes
- `organisation_id` ‚Üí `organisations.organisation_id`

---

## ‚öôÔ∏è TRIGGERS

### 1. trigger_set_created_audit_fields_openai_connexion
- **√âv√©nement:** BEFORE INSERT
- **Fonction:** `set_created_audit_fields_openai_connexion()`
- **Objectif:** D√©finit les champs d'audit √† la cr√©ation

### 2. trigger_update_audit_fields_openai_connexion
- **√âv√©nement:** BEFORE UPDATE
- **Fonction:** `update_audit_fields_openai_connexion()`
- **Objectif:** Met √† jour les champs d'audit

---

## üîß FONCTIONS LI√âES

### Fonctions principales
- `set_created_audit_fields_openai_connexion()` : Gestion audit cr√©ation
- `update_audit_fields_openai_connexion()` : Gestion audit modification

---

## üéØ NOTES TECHNIQUES

### Int√©gration
- **API OpenAI** : Mod√®les GPT et IA g√©n√©ratives
- **Quotas** : Surveillance des limites d'usage et co√ªts
- **Mod√®les** : Gestion des permissions par mod√®le

### S√©curit√©
- **Cl√©s API** : Stockage s√©curis√© des credentials
- **Isolation** : Par organisation via RLS
- **Budget** : Contr√¥le des co√ªts mensuels

### Sp√©cificit√©s OpenAI
- **Organisation/Projet** : Support structure OpenAI
- **Mod√®les autoris√©s** : Array des mod√®les disponibles
- **Gestion co√ªts** : Suivi co√ªt actuel et limite mensuelle

### Gestion Budget
- **Co√ªt mensuel** : Tracking pr√©cis des d√©penses
- **Limite** : Contr√¥le budg√©taire automatique
- **Mod√®les** : Restriction d'acc√®s par mod√®le

### Business Logic
- **Multi-tenant** : Connexions par organisation
- **Client polymorphe** : Support tous types clients
- **Statut connexion** : Monitoring sant√© API

### Performance
- **Index** : Sur organisation_id et client_id
- **Audit JSON** : Logs structur√©s pour analyse
- **Extensions IA** : M√©tadonn√©es pour int√©grations futures
- **Precision co√ªts** : Numeric pour calculs pr√©cis

*Documentation g√©n√©r√©e automatiquement le 17.08.2025*