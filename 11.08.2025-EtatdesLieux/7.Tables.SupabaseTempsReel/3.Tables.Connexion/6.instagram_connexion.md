# TABLE: instagram_connexion

**Date de g√©n√©ration:** 17.08.2025  
**Statut:** ‚úÖ ACTIVE  
**Type:** Table technique - Connexions API Instagram

---

## üìã STRUCTURE DE LA TABLE

| Colonne | Type | Nullable | D√©faut | Description |
|---------|------|----------|--------|-------------|
| instagram_connexion_id | uuid | NO | gen_random_uuid() | üîë Identifiant unique |
| organisation_id | uuid | NO | - | üîó Organisation de rattachement |
| client_type | text | NO | 'reseau' | Type de client |
| client_id | uuid | NO | - | üîó R√©f√©rence client |
| instagram_connexion_key | text | NO | - | üîê Cl√© de connexion |
| instagram_email_compte | text | NO | - | Email du compte Instagram |
| instagram_access_token | text | YES | - | Token d'acc√®s |
| instagram_token_expire_at | timestamp with time zone | YES | - | Expiration du token |
| instagram_actif | boolean | NO | true | Statut actif/inactif |
| instagram_date_activation | timestamp with time zone | NO | now() | Date d'activation |
| instagram_derniere_synchro | timestamp with time zone | YES | - | Derni√®re synchronisation |
| instagram_statut_connexion | text | NO | 'active' | Statut de la connexion |
| instagram_derniere_erreur | text | YES | - | Derni√®re erreur rencontr√©e |
| instagram_limite_quotidienne | integer | YES | - | Limite quotidienne API |
| instagram_usage_quotidien | integer | YES | 0 | Usage quotidien actuel |
| instagram_reset_quota_at | timestamp with time zone | YES | - | Reset du quota |
| instagram_business_account_id | text | YES | - | ID compte business |
| instagram_page_id | text | YES | - | ID de la page li√©e |
| instagram_permissions | ARRAY | YES | '{instagram_basic,pages_read_engagement,instagram_manage_insights}' | Permissions accord√©es |
| instagram_type_compte | text | YES | - | Type de compte Instagram |
| instagram_created_at | timestamp with time zone | NO | now() | Date de cr√©ation |
| instagram_created_by | uuid | YES | - | Cr√©√© par (utilisateur) |
| instagram_updated_at | timestamp with time zone | NO | now() | Date de modification |
| instagram_updated_by | uuid | YES | - | Modifi√© par (utilisateur) |
| instagram_audit_log | jsonb | YES | '{}' | Journal d'audit |
| instagram_ia_extensions | jsonb | YES | '{}' | Extensions IA |

---

## ‚ö° TRIGGERS

#### 1. trigger_set_created_audit_fields_instagram_connexion
- **Type:** BEFORE INSERT
- **Fonction:** set_created_audit_fields_instagram_connexion()
- **Description:** D√©finit les champs d'audit √† la cr√©ation

#### 2. trigger_update_audit_fields_instagram_connexion
- **Type:** BEFORE UPDATE
- **Fonction:** update_audit_fields_instagram_connexion()
- **Description:** Met √† jour les champs d'audit

---

## üîó RELATIONS ENTRE TABLES (FK)

### Relations sortantes
- **instagram_connexion.organisation_id** ‚Üí organisations.organisation_id (implicite)

---

## üîß FONCTIONS LI√âES

### Fonctions utilisant cette table
- **set_created_audit_fields_instagram_connexion()**: Trigger d'insertion
- **update_audit_fields_instagram_connexion()**: Trigger de mise √† jour

---

## üõ°Ô∏è S√âCURIT√â RLS

**RLS Activ√©e:** ‚úÖ OUI  
**RLS Forc√©e:** ‚ùå NON

### Policies RLS

#### 1. admin_presenca_full_access_instagram_connexion
- **Type:** ALL
- **R√¥les:** authenticated
- **Condition:** `is_admin_presenca(auth.uid())`

#### 2. organisation_only_access_instagram_connexion
- **Type:** ALL
- **R√¥les:** authenticated
- **Condition:** `organisation_id = get_user_organisation_id(auth.uid())`

---

## üéØ NOTES TECHNIQUES

### Int√©gration
- **API Instagram** : Gestion comptes business et publications Meta
- **OAuth** : Tokens d'acc√®s avec expiration g√©r√©e
- **Insights** : Acc√®s aux analytics et m√©triques Instagram

### S√©curit√©
- **Tokens OAuth** : Stockage s√©curis√© avec expiration
- **Isolation** : Par organisation via RLS
- **Quotas** : Surveillance des limites Instagram API

### Performance
- **Index automatique** : Sur instagram_connexion_id (PRIMARY KEY)
- **Relations optimis√©es** : FK vers organisation
- **Audit complet** : Triggers automatiques pour suivi

*Documentation g√©n√©r√©e automatiquement le 17.08.2025*