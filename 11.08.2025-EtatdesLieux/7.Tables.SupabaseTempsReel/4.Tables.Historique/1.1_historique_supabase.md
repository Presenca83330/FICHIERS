# TABLE: 1_historique_supabase

**Date de g√©n√©ration:** 17.08.2025  
**Statut:** ‚úÖ ACTIVE  
**Type:** Table technique - Journal d'audit syst√®me

---

## üìã STRUCTURE DE LA TABLE

| Colonne | Type | Nullable | D√©faut | Description |
|---------|------|----------|--------|-------------|
| audit_log_id | uuid | NO | gen_random_uuid() | üîë Identifiant unique |
| organisation_id | uuid | NO | - | üîó Organisation de rattachement |
| historique_table_name | text | NO | - | Nom de la table concern√©e |
| historique_operation | text | NO | - | Type d'op√©ration |
| historique_old_data | jsonb | YES | - | Anciennes donn√©es |
| historique_new_data | jsonb | YES | - | Nouvelles donn√©es |
| user_id | uuid | YES | - | üîó Utilisateur concern√© |
| historique_timestamp | timestamp with time zone | NO | now() | Horodatage |
| historique_session_info | jsonb | YES | '{}' | Informations de session |
| historique_source | text | YES | - | Source de l'op√©ration |
| historique_severity | text | YES | 'info' | Niveau de gravit√© |
| historique_metadata | jsonb | YES | '{}' | M√©tadonn√©es |
| historique_created_at | timestamp with time zone | NO | now() | Date de cr√©ation |
| historique_created_by | uuid | YES | - | Cr√©√© par (utilisateur) |

---

## üîç CONTRAINTES

### Contraintes CHECK
- `historique_operation_check` : Op√©ration limit√©e √† 'INSERT', 'UPDATE', 'DELETE', 'WEBHOOK_RECEIVED', 'HOOK_EXECUTED', 'CRON_JOB', 'MANUAL_ACTION', 'ERROR', 'AUTH_LOGIN', 'AUTH_LOGOUT'
- `historique_severity_check` : Gravit√© limit√©e √† 'debug', 'info', 'warning', 'error', 'critical'
- `historique_source_check` : Source limit√©e √† 'trigger', 'application', 'webhook', 'system', 'manual' ou NULL

---

## üìä INDEX

- `1_historique_supabase_pkey` : UNIQUE BTREE (audit_log_id)
- `idx_audit_organisation_date` : BTREE (organisation_id, historique_created_at)

---

## üõ°Ô∏è S√âCURIT√â RLS

**RLS Activ√©e:** ‚úÖ OUI  
**RLS Forc√©e:** ‚ùå NON

### Policies RLS

#### 1. admin_presenca_full_access_historique
- **Type:** ALL
- **R√¥les:** public
- **Condition:** `is_admin_presenca(auth.uid())`

#### 2. organisation_only_access_historique
- **Type:** ALL
- **R√¥les:** public
- **Condition:** `organisation_id = get_user_organisation_id(auth.uid())`

---

## üéØ NOTES TECHNIQUES

### Audit
- **Journal central** : Toutes les op√©rations importantes du syst√®me
- **Multi-sources** : Triggers, application, webhooks, syst√®me, manuel
- **Niveaux** : Debug, info, warning, error, critical

### Performance
- **Index composite** : organisation_id + historique_created_at pour requ√™tes temporelles
- **Partition recommand√©e** : Par date pour optimiser les performances
- **Archivage** : Strat√©gie de r√©tention √† d√©finir

### S√©curit√©
- **Isolation stricte** : Par organisation via RLS
- **Immutabilit√©** : Logs prot√©g√©s en lecture seule apr√®s cr√©ation
- **Tra√ßabilit√©** : Suivi complet des modifications syst√®me

*Documentation g√©n√©r√©e automatiquement le 17.08.2025*