# Logique Organisations â€“ LeadGenAI AdBuilder

## 1. **organisations** (pivot multi-tenant)
- Câ€™est lâ€™entitÃ© **racine** de ton systÃ¨me multi-tenant.  
- Chaque organisation reprÃ©sente :  
  - Soit un **rÃ©seau** (franchise, groupement).  
  - Soit une **agence indÃ©pendante**.  
- Toutes les autres entitÃ©s (users, utilisateurs, agences, connexions API, abonnements Stripe, historique, etc.) y sont reliÃ©es.

**Champs clÃ©s :**
- `organisation_id` (PK, UUID)
- `organisation_nom`
- `organisation_siret` (si entreprise)
- `organisation_identite_commerciale` (nom affichÃ©)
- `organisation_adresse`, `ville`, `code_postal`, `email`, `tÃ©lÃ©phone`
- `organisation_plan_stripe` (plan souscrit)
- `organisation_statut_compte` : actif / suspendu / dÃ©sactivÃ©
- `organisation_statut_paiement` : Ã _jour / en_retard / annulÃ©
- `organisation_date_creation`

---

## 2. Relations clÃ©s
- `users.users_organisation_id â†’ organisations.organisation_id`
- `utilisateurs.utilisateur_organisation_id â†’ organisations.organisation_id`
- Chaque table client (`reseau`, `reseau_agence`, `agence_independante`, etc.) a aussi son `organisation_id`.  
- Toutes les connexions externes (Brevo, Zoho, OpenAI, LinkedIn, Facebook, Instagram) â†’ `organisation_id`.  
- Stripe : `abonnement_stripe.organisation_id`.  
- Historique : `1_historique_supabase.organisation_id`.  

ğŸ‘‰ Tout passe par `organisation_id` â†’ câ€™est la **clÃ© de cloisonnement** multi-tenant.

---

## 3. SÃ©curitÃ© (RLS)
- **RLS activÃ©e** âœ…
- Policies :
  - Admin PRESENCA â†’ accÃ¨s complet.
  - Sinon : accÃ¨s uniquement aux donnÃ©es dont `organisation_id = get_user_organisation_id(auth.uid())`.
- **CrÃ©ation / suppression dâ€™organisations** : rÃ©servÃ©e uniquement aux admin PRESENCA.

---

## 4. Logique mÃ©tier
- Une organisation = un **tenant** (un silo de donnÃ©es).  
- Chaque rÃ©seau ou agence indÃ©pendante est une organisation Ã  part entiÃ¨re.  
- Les agences membres dâ€™un rÃ©seau (`reseau_agence`) sont techniquement rattachÃ©es Ã  la mÃªme organisation_id que le rÃ©seau.  
- Si une agence rÃ©seau quitte un rÃ©seau â†’ elle peut basculer vers une **organisation indÃ©pendante** (migration dâ€™ID).

---

## ğŸ¯ SynthÃ¨se
- **organisations** = socle de ton modÃ¨le multi-tenant.  
- Tout est rattachÃ© Ã  `organisation_id` : users, utilisateurs, clients, abonnements, connexions, logs.  
- **RLS** garantit que personne ne voit au-delÃ  de son organisation.  
- **Admin PRESENCA** est le seul Ã  pouvoir crÃ©er/supprimer des organisations.

---

ğŸ‘‰ Ce document sert de **mÃ©mo rapide** pour rappeler la logique Organisations en cas de trou de mÃ©moire ou pour lâ€™expliquer Ã  un tiers (ex. Lovable IA).

