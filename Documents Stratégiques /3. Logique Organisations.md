# Logique Organisations – LeadGenAI AdBuilder

## 1. **organisations** (pivot multi-tenant)
- C’est l’entité **racine** de ton système multi-tenant.  
- Chaque organisation représente :  
  - Soit un **réseau** (franchise, groupement).  
  - Soit une **agence indépendante**.  
- Toutes les autres entités (users, utilisateurs, agences, connexions API, abonnements Stripe, historique, etc.) y sont reliées.

**Champs clés :**
- `organisation_id` (PK, UUID)
- `organisation_nom`
- `organisation_siret` (si entreprise)
- `organisation_identite_commerciale` (nom affiché)
- `organisation_adresse`, `ville`, `code_postal`, `email`, `téléphone`
- `organisation_plan_stripe` (plan souscrit)
- `organisation_statut_compte` : actif / suspendu / désactivé
- `organisation_statut_paiement` : à_jour / en_retard / annulé
- `organisation_date_creation`

---

## 2. Relations clés
- `users.users_organisation_id → organisations.organisation_id`
- `utilisateurs.utilisateur_organisation_id → organisations.organisation_id`
- Chaque table client (`reseau`, `reseau_agence`, `agence_independante`, etc.) a aussi son `organisation_id`.  
- Toutes les connexions externes (Brevo, Zoho, OpenAI, LinkedIn, Facebook, Instagram) → `organisation_id`.  
- Stripe : `abonnement_stripe.organisation_id`.  
- Historique : `1_historique_supabase.organisation_id`.  

👉 Tout passe par `organisation_id` → c’est la **clé de cloisonnement** multi-tenant.

---

## 3. Sécurité (RLS)
- **RLS activée** ✅
- Policies :
  - Admin PRESENCA → accès complet.
  - Sinon : accès uniquement aux données dont `organisation_id = get_user_organisation_id(auth.uid())`.
- **Création / suppression d’organisations** : réservée uniquement aux admin PRESENCA.

---

## 4. Logique métier
- Une organisation = un **tenant** (un silo de données).  
- Chaque réseau ou agence indépendante est une organisation à part entière.  
- Les agences membres d’un réseau (`reseau_agence`) sont techniquement rattachées à la même organisation_id que le réseau.  
- Si une agence réseau quitte un réseau → elle peut basculer vers une **organisation indépendante** (migration d’ID).

---

## 🎯 Synthèse
- **organisations** = socle de ton modèle multi-tenant.  
- Tout est rattaché à `organisation_id` : users, utilisateurs, clients, abonnements, connexions, logs.  
- **RLS** garantit que personne ne voit au-delà de son organisation.  
- **Admin PRESENCA** est le seul à pouvoir créer/supprimer des organisations.

---

👉 Ce document sert de **mémo rapide** pour rappeler la logique Organisations en cas de trou de mémoire ou pour l’expliquer à un tiers (ex. Lovable IA).

