# Logique Users / Utilisateurs / Organisations â€“ LeadGenAI AdBuilder

## 1. **users** (profil systÃ¨me, pont avec Supabase Auth)

- ReliÃ©e directement Ã  **auth.users.id** via `users_auth_id`.  
- Stocke les infos stratÃ©giques liÃ©es Ã  lâ€™authentification et Ã  lâ€™intÃ©gration dans ton systÃ¨me.  

**Champs principaux :**
- `users_id` (PK interne)
- `users_auth_id` (FK â†’ auth.users)
- `users_email` (unique)
- `users_role` (admin / client)
- `users_role_systeme` (admin_presenca / superadmin / support / â€¦)
- `users_interface_par_defaut` (admin_presenca / client_espace)
- `users_organisation_id` (FK â†’ organisations)

ğŸ‘‰ **RÃ´le** : pivot technique â†’ assure que chaque compte Auth est rattachÃ© Ã  une organisation et reconnu par toutes les FK de ton modÃ¨le.

---

## 2. **utilisateurs** (profil mÃ©tier enrichi)

- Câ€™est la version â€œbusinessâ€ dâ€™un user, rattachÃ©e Ã  une organisation.  

**Champs principaux :**
- `utilisateur_id` (PK)
- `utilisateur_auth_uid` (FK â†’ auth.users)
- `utilisateur_organisation_id` (FK â†’ organisations)
- `utilisateur_type_compte` (reseau / agence_independante, â€¦)
- `utilisateur_role` (responsable, collaborateur, â€¦)
- `utilisateur_statut` (actif, suspendu, en_attente, â€¦)
- `utilisateur_role_systeme` (admin_presenca, superadmin, supportâ€¦)

ğŸ‘‰ **RÃ´le** : profil mÃ©tier visible par PRESENCA et les admins des organisations â†’ gÃ¨re les hiÃ©rarchies, statuts, droits.

---

## 3. **organisations** (pivot multi-tenant)

- EntitÃ© racine â†’ isole les donnÃ©es.  

**Champs principaux :**
- `organisation_id` (PK)
- `organisation_nom`
- `organisation_statut_compte` (actif, suspendu, dÃ©sactivÃ©)
- `organisation_statut_paiement` (Ã _jour, en_retard, annulÃ©)

ğŸ‘‰ **RÃ´le** : le tenant. Chaque donnÃ©e (users, utilisateurs, rÃ©seaux, agences, connexions, abonnement Stripe, historique) est rattachÃ©e Ã  une organisation.

---

## ğŸ”‘ La logique globale

- **users** = identitÃ© Auth technique (lien direct avec Supabase Auth + rattachement organisation).  
- **utilisateurs** = profil mÃ©tier (type de compte, rÃ´le, statut).  
- **organisations** = le tenant (isolation stricte via RLS).  

Les deux premiers (**users** et **utilisateurs**) sont synchronisÃ©s pour Ã©viter les Ã©carts :
- `users` â†’ cÃ´tÃ© systÃ¨me/Auth.  
- `utilisateurs` â†’ cÃ´tÃ© business/mÃ©tier.  

---

## ğŸ¯ SynthÃ¨se

Ton modÃ¨le permet de **sÃ©parer clairement lâ€™authentification (sÃ©curitÃ©)** et le **mÃ©tier (multi-tenant hiÃ©rarchique)**, tout en gardant lâ€™**admin PRESENCA** comme garant de la cohÃ©rence (validation des comptes).

Ce document peut servir de **mÃ©mo** en cas de trou de mÃ©moire ou pour expliquer la logique Ã  un tiers (ex. Lovable IA).

