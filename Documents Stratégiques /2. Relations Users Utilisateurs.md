# Logique Users / Utilisateurs / Organisations – LeadGenAI AdBuilder

## 1. **users** (profil système, pont avec Supabase Auth)

- Reliée directement à **auth.users.id** via `users_auth_id`.  
- Stocke les infos stratégiques liées à l’authentification et à l’intégration dans ton système.  

**Champs principaux :**
- `users_id` (PK interne)
- `users_auth_id` (FK → auth.users)
- `users_email` (unique)
- `users_role` (admin / client)
- `users_role_systeme` (admin_presenca / superadmin / support / …)
- `users_interface_par_defaut` (admin_presenca / client_espace)
- `users_organisation_id` (FK → organisations)

👉 **Rôle** : pivot technique → assure que chaque compte Auth est rattaché à une organisation et reconnu par toutes les FK de ton modèle.

---

## 2. **utilisateurs** (profil métier enrichi)

- C’est la version “business” d’un user, rattachée à une organisation.  

**Champs principaux :**
- `utilisateur_id` (PK)
- `utilisateur_auth_uid` (FK → auth.users)
- `utilisateur_organisation_id` (FK → organisations)
- `utilisateur_type_compte` (reseau / agence_independante, …)
- `utilisateur_role` (responsable, collaborateur, …)
- `utilisateur_statut` (actif, suspendu, en_attente, …)
- `utilisateur_role_systeme` (admin_presenca, superadmin, support…)

👉 **Rôle** : profil métier visible par PRESENCA et les admins des organisations → gère les hiérarchies, statuts, droits.

---

## 3. **organisations** (pivot multi-tenant)

- Entité racine → isole les données.  

**Champs principaux :**
- `organisation_id` (PK)
- `organisation_nom`
- `organisation_statut_compte` (actif, suspendu, désactivé)
- `organisation_statut_paiement` (à_jour, en_retard, annulé)

👉 **Rôle** : le tenant. Chaque donnée (users, utilisateurs, réseaux, agences, connexions, abonnement Stripe, historique) est rattachée à une organisation.

---

## 🔑 La logique globale

- **users** = identité Auth technique (lien direct avec Supabase Auth + rattachement organisation).  
- **utilisateurs** = profil métier (type de compte, rôle, statut).  
- **organisations** = le tenant (isolation stricte via RLS).  

Les deux premiers (**users** et **utilisateurs**) sont synchronisés pour éviter les écarts :
- `users` → côté système/Auth.  
- `utilisateurs` → côté business/métier.  

---

## 🎯 Synthèse

Ton modèle permet de **séparer clairement l’authentification (sécurité)** et le **métier (multi-tenant hiérarchique)**, tout en gardant l’**admin PRESENCA** comme garant de la cohérence (validation des comptes).

Ce document peut servir de **mémo** en cas de trou de mémoire ou pour expliquer la logique à un tiers (ex. Lovable IA).

